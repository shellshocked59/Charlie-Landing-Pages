//
// jQuery.DOMWindow.js is copyright Cody Lindley and released under the MIT license.
// Updates and bug fixes by Eli Dickinson http://elidickinson.com/
// Additional updates and fixes by the1stMovement
(function(b){b.fn.closeDOMWindow=function(d){d||(d={});var c=function(){if(d.anchoredClassName){var a=b("."+d.anchoredClassName);a.fadeOut("fast",function(){b.fn.draggable?a.draggable("destory").trigger("unload").remove():a.trigger("unload").remove()});d.functionCallOnClose&&d.functionCallAfterClose()}else{var c=b("#DOMWindowOverlay"),h=b("#DOMWindow");c.fadeOut("fast",function(){c.trigger("unload").unbind().remove()});h.fadeOut("fast",function(){b.fn.draggable?h.draggable("destroy").trigger("unload").remove(): h.trigger("unload").remove()});b(window).unbind("scroll.DOMWindow");b(window).unbind("resize.DOMWindow");b.fn.openDOMWindow.isIE6&&b("#DOMWindowIE6FixIframe").remove();d.functionCallOnClose&&d.functionCallOnClose()}};if(d.eventType)return this.each(function(){b(this).bind(d.eventType,function(){c(this);return!1})});else c()};b.closeDOMWindow=function(d){b.fn.closeDOMWindow(d)};b.fn.openDOMWindow=function(d){var c=b.fn.openDOMWindow;c.defaultsSettings={anchoredClassName:"",anchoredSelector:"",borderColor:"#ccc", borderSize:"4",draggable:0,eventType:null,fixedWindowY:100,functionCallOnOpen:null,functionCallOnClose:null,height:500,loader:0,loaderHeight:0,loaderImagePath:"",loaderWidth:0,modal:0,overflow:"auto",overlay:1,overlayColor:"#000",overlayOpacity:"85",positionLeft:0,positionTop:0,positionType:"centered",width:500,windowBGColor:"#fff",windowBGImage:null,windowHTTPType:"get",windowPadding:10,windowSource:"inline",windowSourceID:"",windowSourceURL:"",windowSourceAttrURL:"href"};var a=b.extend({},b.fn.openDOMWindow.defaultsSettings, d||{});c.viewPortHeight=function(){return self.innerHeight||document.documentElement.clientHeight||document.body.clientHeight};c.viewPortWidth=function(){return self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth};c.scrollOffsetHeight=function(){return self.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop};c.scrollOffsetWidth=function(){return self.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft};c.isIE6=typeof document.body.style.maxHeight=== "undefined";var i=function(){var a=b("#DOMWindowOverlay");c.isIE6?a.css({height:document.documentElement.offsetHeight+document.documentElement.scrollTop-4+"px",width:document.documentElement.offsetWidth-21+"px"}):a.css({height:"100%",width:"100%",position:"fixed"})},h=function(){var a=document.documentElement.offsetHeight+document.documentElement.scrollTop-4,c=document.documentElement.offsetWidth-21;b("#DOMWindowIE6FixIframe").css({height:a+"px",width:c+"px"})},j=function(){var e=b("#DOMWindow"); a.height+50>c.viewPortHeight()?e.css("left",Math.round(c.viewPortWidth()/2)+c.scrollOffsetWidth()-Math.round(e.outerWidth()/2)):(e.css("left",Math.round(c.viewPortWidth()/2)+c.scrollOffsetWidth()-Math.round(e.outerWidth()/2)),e.css("top",Math.round(c.viewPortHeight()/2)+c.scrollOffsetHeight()-Math.round(e.outerHeight()/2)))},n=function(){var a=b("#DOMWindowLoader");c.isIE6?(a.css({left:Math.round(c.viewPortWidth()/2)+c.scrollOffsetWidth()-Math.round(a.innerWidth()/2),position:"absolute"}),a.css({top:Math.round(c.viewPortHeight()/ 2)+c.scrollOffsetHeight()-Math.round(a.innerHeight()/2),position:"absolute"})):a.css({left:"50%",top:"50%",position:"fixed"})},k=function(){var e=b("#DOMWindow");e.css("left",a.positionLeft+c.scrollOffsetWidth());e.css("top",+a.positionTop+c.scrollOffsetHeight())},g=function(c){c?(b("."+c+" #DOMWindowLoader").remove(),b("."+c+" #DOMWindowContent").fadeIn("fast",function(){a.functionCallOnOpen&&a.functionCallOnOpen()}),b("."+c+".closeDOMWindow").click(function(){b.closeDOMWindow();return!1})):(a.waitForIframe&& b("#DOMWindowOverlay").fadeIn("fast"),b("#DOMWindowLoader").remove(),b("#DOMWindow").fadeIn("fast",function(){a.functionCallOnOpen&&a.functionCallOnOpen()}),b("#DOMWindow .closeDOMWindow").click(function(){b.closeDOMWindow();return!1}))},l=function(a){var b={};a.replace(/b([^&=]*)=([^&=]*)b/g,function(a,c,e){typeof b[c]!="undefined"?b[c]+=","+e:b[c]=e});return b},m=function(e){a.windowSourceID=b(e).attr("href")||a.windowSourceID;a.windowSourceURL=b(e).attr(a.windowSourceAttrURL)||a.windowSourceURL; a.windowBGImage=a.windowBGImage?"background-image:url("+a.windowBGImage+")":"";var d;if(a.positionType=="anchored")switch(d=b(a.anchoredSelector).position(),e=d.left+a.positionLeft,d=d.top+a.positionTop,b("body").append('<div class="'+a.anchoredClassName+'" style="'+a.windowBGImage+";background-repeat:no-repeat;padding:"+a.windowPadding+"px;overflow:"+a.overflow+";position:absolute;top:"+d+"px;left:"+e+"px;height:"+a.height+"px;width:"+a.width+"px;background-color:"+a.windowBGColor+";border:"+a.borderSize+ "px solid "+a.borderColor+';z-index:10001"><div id="DOMWindowContent" style="display:none"></div></div>'),a.loader&&a.loaderImagePath!==""&&b("."+a.anchoredClassName).append('<div id="DOMWindowLoader" style="width:'+a.loaderWidth+"px;height:"+a.loaderHeight+'px;"><img src="'+a.loaderImagePath+'" /></div>'),b.fn.draggable&&a.draggable&&b("."+a.anchoredClassName).draggable({cursor:"move"}),a.windowSource){case "inline":b("."+a.anchoredClassName+" #DOMWindowContent").append(b(a.windowSourceID).children()); b("."+a.anchoredClassName).unload(function(){b(a.windowSourceID).append(b("."+a.anchoredClassName+" #DOMWindowContent").children())});g(a.anchoredClassName);break;case "iframe":b("."+a.anchoredClassName+" #DOMWindowContent").append('<iframe frameborder="0" hspace="0" wspace="0" src="'+a.windowSourceURL+'" name="DOMWindowIframe'+Math.round(Math.random()*1E3)+'" style="width:100%;height:100%;border:none;background-color:#fff;" class="'+a.anchoredClassName+'Iframe" ></iframe>');b("."+a.anchoredClassName+ "Iframe").load(g(a.anchoredClassName));break;case "ajax":a.windowHTTPType=="post"?(a.windowSourceURL.indexOf("?")!==-1?(e=a.windowSourceURL.substr(0,a.windowSourceURL.indexOf("?")),d=l(a.windowSourceURL)):(e=a.windowSourceURL,d={}),b("."+a.anchoredClassName+" #DOMWindowContent").load(e,d,function(){g(a.anchoredClassName)})):(a.windowSourceURL.indexOf("?")==-1&&(a.windowSourceURL+="?"),b("."+a.anchoredClassName+" #DOMWindowContent").load(a.windowSourceURL+"&random="+(new Date).getTime(),function(){g(a.anchoredClassName)}))}else{a.overlay&& (b("body").append('<div id="DOMWindowOverlay" style="z-index:10000;display:none;position:absolute;top:0;left:0;background-color:'+a.overlayColor+";filter:alpha(opacity="+a.overlayOpacity+");-moz-opacity: 0."+a.overlayOpacity+";opacity: 0."+a.overlayOpacity+';"></div>'),c.isIE6&&(b("body").append('<iframe id="DOMWindowIE6FixIframe" style="width:100%;height:100%;z-index:9999;position:absolute;top:0;left:0;filter:alpha(opacity=0);"></iframe>'),h()),i(),e=b("#DOMWindowOverlay"),a.waitForIframe||e.fadeIn("fast"), a.modal||e.click(function(){b.closeDOMWindow()}));a.loader&&a.loaderImagePath!==""&&(b("body").append('<div id="DOMWindowLoader" style="z-index:10002;width:'+a.loaderWidth+"px;height:"+a.loaderHeight+'px;"><img src="'+a.loaderImagePath+'" /></div>'),n());b("body").append('<div id="DOMWindow" style="background-repeat:no-repeat;'+a.windowBGImage+";overflow:"+a.overflow+";padding:"+a.windowPadding+"px;display:none;height:"+a.height+"px;width:"+a.width+"px;background-color:"+a.windowBGColor+";border:"+ a.borderSize+"px solid "+a.borderColor+'; position:absolute;z-index:10001"></div>');var f=b("#DOMWindow");switch(a.positionType){case "centered":j();a.height+50>c.viewPortHeight()&&f.css("top",a.fixedWindowY+c.scrollOffsetHeight()+"px");break;case "absolute":f.css({top:a.positionTop+c.scrollOffsetHeight()+"px",left:a.positionLeft+c.scrollOffsetWidth()+"px"});b.fn.draggable&&a.draggable&&f.draggable({cursor:"move"});break;case "fixed":k();break;case "anchoredSingleWindow":d=b(a.anchoredSelector).position(), e=d.left+a.positionLeft,d=d.top+a.positionTop,f.css({top:d+"px",left:e+"px"})}b(window).bind("scroll.DOMWindow",function(){a.overlay&&i();c.isIE6&&h();a.positionType=="centered"&&j();a.positionType=="fixed"&&k()});b(window).bind("resize.DOMWindow",function(){c.isIE6&&h();a.overlay&&i();a.positionType=="centered"&&j()});switch(a.windowSource){case "inline":f.append(b(a.windowSourceID).children());f.unload(function(){b(a.windowSourceID).append(f.children())});g();break;case "iframe":f.append('<iframe frameborder="0" hspace="0" wspace="0" src="'+ a.windowSourceURL+'" name="DOMWindowIframe'+Math.round(Math.random()*1E3)+'" style="width:100%;height:100%;border:none;background-color:#fff;" id="DOMWindowIframe" ></iframe>');b("#DOMWindowIframe").load(function(){g()});break;case "ajax":a.windowHTTPType=="post"?(a.windowSourceURL.indexOf("?")!==-1?(e=a.windowSourceURL.substr(0,a.windowSourceURL.indexOf("?")),d=l(a.windowSourceURL)):(e=a.windowSourceURL,d={}),f.load(e,d,function(){g()})):(a.windowSourceURL.indexOf("?")==-1&&(a.windowSourceURL+="?"), f.load(a.windowSourceURL+"&random="+(new Date).getTime(),function(){g()}))}}};if(a.eventType)return this.each(function(){b(this).bind(a.eventType,function(){m(this);return!1})});else m()};b.openDOMWindow=function(d){b.fn.openDOMWindow(d)}})(jQuery);